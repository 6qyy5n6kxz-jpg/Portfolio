# Photo Gallery

A modern, responsive photo gallery static site for GitHub Pages that pulls images from a public Google Drive folder. Features include:

- **Google Drive Integration**: Reads images directly from Drive API v3
- **On-Device ML Tagging**: TensorFlow.js mobilenet classifies images in-browser
- **EXIF Extraction**: Extracts camera, lens, date, and orientation metadata
- **Smart Filtering**: Filter by season, difficulty, orientation, year, and color
- **Full-Text Search**: Search across image names, tags, camera, and lens
- **Pagination**: Configurable items per page
- **Manifest Caching**: localStorage caching + periodic GitHub Action updates
- **Dark Theme**: Modern, responsive UI with smooth animations
- **Lazy Loading**: Images load on-demand for performance
- **Graceful Degradation**: Works without ML if mobilenet unavailable

## Setup

### 1. Create Google Drive Folder & API Key

1. Create a public folder in Google Drive and copy its ID from the URL: `https://drive.google.com/drive/folders/{FOLDER_ID}`
2. Create a **Google Cloud Project**:
   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Create a new project
   - Enable the **Google Drive API**
   - Create an **API Key** (restrict to HTTP referrers: `*github.io/*`)
3. Make your Drive folder **public** (anyone with link can view)

### 2. Configure Your Site

Edit `public/config.json`:

```json
{
  "title": "My Photo Gallery",
  "GOOGLE_DRIVE_FOLDER_ID": "your-folder-id-here",
  "GOOGLE_API_KEY": "your-api-key-here",
  "ITEMS_PER_PAGE": 20,
  "enableMLTagging": true
}
```

**Security Note**: The API key is public-facing in the browser. Restrict it via:
- HTTP referrer restrictions to your GitHub Pages domain
- API quotas in Google Cloud Console

### 3. Set Up GitHub Secrets (for automatic manifest generation)

In your repository settings → **Secrets and variables** → **Actions secrets**, add:

- `GOOGLE_API_KEY`: Your Google Cloud API key
- `GOOGLE_DRIVE_FOLDER_ID`: Your Drive folder ID

The workflow will generate `public/manifest.json` nightly (see `.github/workflows/build-manifest.yml`).

### 4. Deploy to GitHub Pages

1. Push this repo to GitHub
2. Go to repository **Settings** → **Pages**
3. Select **Deploy from a branch** → `main` branch
4. Save
5. Your site will be live at `https://username.github.io/my-portfolio`

## File Structure

```
my-portfolio/
├── index.html                    # Gallery UI (HTML template)
├── style.css                     # Dark theme styles
├── app.js                        # Main app logic (ES module)
├── public/
│   ├── config.json              # Configuration (fill in your API key)
│   └── manifest.json            # Generated by GitHub Action (optional)
├── scripts/
│   └── build_manifest.py        # Python script to build manifest
├── .github/workflows/
│   └── build-manifest.yml       # GitHub Action workflow
└── README.md                    # This file
```

## How It Works

### On First Visit (or cache expired)

1. Browser loads `app.js` and checks for cached manifest in localStorage
2. If missing/expired, tries to fetch `public/manifest.json`
3. If that fails, queries Google Drive API v3 directly
4. Extracts EXIF metadata from each image
5. Loads TensorFlow mobilenet model
6. Classifies each image (top 3 predictions become tags)
7. Computes color classification and difficulty
8. Caches manifest for 24 hours
9. Renders gallery with filters & pagination

### On Subsequent Visits (within 24 hours)

- Loads manifest from localStorage immediately (no API calls)
- Renders gallery instantly

### GitHub Action (Nightly)

- `scripts/build_manifest.py` queries Google Drive API
- Builds lightweight manifest with basic season/year metadata
- Commits `public/manifest.json` to repo (skip heavy ML here)
- Browsers use pre-built manifest on first load (faster)

## Manifest Structure

Each image entry:

```json
{
  "id": "drive-file-id",
  "name": "Image Title",
  "src": "https://lh3.googleusercontent.com/d/{id}=w800",
  "view": "https://drive.google.com/file/d/{id}",
  "tags": ["tree", "landscape", "sunset"],
  "season": "Fall",
  "year": 2023,
  "difficulty": "Medium",
  "orientation": "Landscape",
  "color": "Warm",
  "camera": "Canon EOS 5D",
  "lens": "EF 24-70mm f/2.8L",
  "width": 4000,
  "height": 3000,
  "dateTime": "2023-10-15T14:30:00Z"
}
```

## Configuration Options

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `title` | string | "Photo Gallery" | Gallery title in header |
| `GOOGLE_DRIVE_FOLDER_ID` | string | (required) | Your public Drive folder ID |
| `GOOGLE_API_KEY` | string | (required) | Google Cloud API key |
| `ITEMS_PER_PAGE` | number | 20 | Images per page |
| `enableMLTagging` | boolean | true | Enable TensorFlow tagging |

## Filters

All filters are dynamically built from image data:

- **Season**: Spring, Summer, Fall, Winter (fixed)
- **Difficulty**: Easy, Medium, Hard (from ML predictions)
- **Orientation**: Landscape, Portrait (from EXIF)
- **Year**: Derived from EXIF DateTimeOriginal or Drive createdTime
- **Color**: Warm, Cool, Neutral (from pixel analysis)

## Search

Keyword search across:
- Image name
- AI-generated tags
- Camera model
- Lens model

Example: `"Canon landscape sunset"` → finds images with those keywords.

## Browser Support

- Chrome/Edge 60+
- Firefox 55+
- Safari 11+
- Mobile browsers (iOS Safari, Chrome Mobile)

Requires:
- TensorFlow.js & mobilenet (CDN)
- exifr (CDN)
- ES2017+ (async/await, fetch)

## Performance Tips

- **Images**: Lazy load via `loading="lazy"`
- **Caching**: 24-hour localStorage cache + GitHub Action weekly updates
- **Manifest**: Pre-built manifest skips API calls on first load
- **ML**: On-device classification (no server)
- **Pagination**: Load only visible page

## Troubleshooting

### Gallery shows "No images found"

1. Check Drive folder is **public**
2. Verify API key is correct in `config.json`
3. Check browser console for errors
4. Ensure folder ID is correct

### Images fail to load

- Google Drive image URLs may be blocked by CORS in some cases
- The fallback uses a gray placeholder image
- Consider using Drive's **"published to web"** feature

### API quota exceeded

- Set **HTTP referrer restrictions** in Google Cloud Console
- Manifest caching (24h) + GitHub Action reduces API calls
- Consider increasing quota in Cloud Console

### ML tagging not working

- mobilenet requires HTTPS (check GitHub Pages is HTTPS)
- Large images slow down classification
- Disable with `"enableMLTagging": false` in config.json

## License

MIT License - feel free to modify and share!

## Credits

Built with:
- [TensorFlow.js](https://www.tensorflow.org/js)
- [mobilenet](https://github.com/tensorflow/tfjs-models/tree/master/mobilenet)
- [exifr](https://github.com/MikeKovarik/exifr)
- [Google Drive API v3](https://developers.google.com/drive/api)
